// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// MODELS 

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  email   String   @unique
  hash    String
  profile Profile?

  @@map("users")
}

model Profile {
  id        Int      @id @default(autoincrement())
  updatedAt DateTime @updatedAt

  bio        String?
  urls       String[]
  profession String?
  firstName  String?
  lastName   String?

  hexAddress   HexAddress? @relation(fields: [hexAddressId], references: [id])
  hexAddressId Int?        @unique

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique

  followedBy Follows[] @relation("following")
  following  Follows[] @relation("follower")

  searches Search[]

  subscriptions Sub[]
  favorites     Fav[]
  userFavOf     FavUsers[] @relation("fav")
  userFavs      FavUsers[] @relation("favOf")

  @@map("profiles")
}

model Follows {
  follower    Profile @relation("follower", fields: [followerId], references: [id])
  followerId  Int
  following   Profile @relation("following", fields: [followingId], references: [id])
  followingId Int

  @@id([followerId, followingId])
}

model FavUsers {
  favOf   Profile @relation("favOf", fields: [favOfId], references: [id])
  favOfId Int
  fav     Profile @relation("fav", fields: [favId], references: [id])
  favId   Int

  @@id([favOfId, favId])
}

model Search {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  query     String

  profile   Profile @relation(fields: [profileId], references: [id])
  profileId Int

  bookmarkedInFavs Fav[]

  @@map("searches")
}

model Sub {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile   Profile @relation(fields: [profileId], references: [id])
  profileId Int

  intents  NLPIntent[]
  entities NLPEntity[]
  tags     NLPTag[]

  contracts HexAddress[]

  @@map("subscriptions")
}

model Fav {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile   Profile @relation(fields: [profileId], references: [id])
  profileId Int

  intents  NLPIntent[]
  entities NLPEntity[]
  tags     NLPTag[]

  contracts HexAddress[]

  searches Search? @relation(fields: [searchId], references: [id])
  searchId Int?

  @@map("favorites")
}

model NLPIntent {
  id      Int    @id @default(autoincrement())
  witUuid String @unique
  name    String @unique

  bookmarkedInSubs Sub[]
  bookmarkedInFavs Fav[]

  @@map("intents")
}

model NLPEntity {
  id      Int      @id @default(autoincrement())
  witUuid String   @unique
  name    String   @unique
  values  String[]

  bookmarkedInSubs Sub[]
  bookmarkedInFavs Fav[]

  @@map("entities")
}

model NLPTag {
  id      Int      @id @default(autoincrement())
  witUuid String?  @unique
  name    String   @unique
  values  String[]

  bookmarkedInSubs Sub[]
  bookmarkedInFavs Fav[]

  @@map("tags")
}

model HexAddress {
  id       Int     @id @default(autoincrement())
  meta     String?
  contract String  @unique

  bookmarkedInSubs Sub[]
  bookmarkedInFavs Fav[]

  profiles Profile[]

  @@map("addresses")
}
